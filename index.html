<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YPBVHHR5CC"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}  
      gtag('js', new Date());
      gtag('config', 'G-YPBVHHR5CC');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Comisiones</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts (Poppins) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; font-family: 'Poppins', sans-serif; padding: 20px; }
        .calculator-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .result-item { margin-bottom: 15px; transition: transform 0.2s; }
        .result-item:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .terminal-logo { width: 80px; height: 80px; margin-right: 20px; object-fit: contain; }
        .result-details { flex-grow: 1; display: flex; justify-content: space-around; align-items: center; }
        .net-amount { font-size: 1.5rem; text-align: center; width: 150px; }
        .commission, .iva, .total { color: #4682B4; text-align: center; }
        .net { color: #28a745; font-weight: bold; }
        .rates-info { margin-top: 20px; font-size: 0.9rem; color: #666; border-top: 1px solid #ddd; padding-top: 10px; }
        .referral-banner { 
            background: #fff;
            color: #333;
            padding: 20px;
            text-align: left;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .referral-banner h4 { text-align: center; margin-bottom: 15px; }
        .referral-offer { display: flex; align-items: center; margin-bottom: 20px; }
        .offer-logo { width: 50px; height: auto; margin-right: 15px; }
        .offer-text { flex-grow: 1; font-size: 0.95rem; }
        .referral-link { display: inline-block; margin-left: 15px; padding: 10px 20px; background: #FFCD00; color: #000; text-decoration: none; font-weight: bold; border-radius: 5px; }
        @media (max-width: 768px) {
            .result-details { flex-direction: column; align-items: flex-start; }
            .commission, .iva, .total { margin-bottom: 5px; width: 100%; text-align: left; }
            .referral-offer { flex-direction: column; align-items: flex-start; }
            .referral-link { margin: 10px 0 0 0; }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1 class="text-center mb-4">Calculadora de Comisiones de Terminales de Venta</h1>
        <label for="amount" class="form-label">Ingresa la cantidad a cobrar</label>
        <div class="input-group mb-3">
            <span class="input-group-text">$</span>
            <input type="number" id="amount" class="form-control" placeholder="Ej: 1000" min="1">
            <button class="btn btn-success" onclick="calculate()">Calcular</button>
        </div>
        <div id="results" class="mt-4"></div>

        <!-- Banner de referidos -->
        <div class="referral-banner" id="referralBanner" style="display: none;">
            <h4>Aprovecha los beneficios de las siguientes promociones</h4>

            <div class="referral-offer">
                <img src="./logos/mercado-pago.png" class="offer-logo" alt="Logo Mercado Pago">
                <p class="offer-text">Descarga la app de Mercado Pago y gana $100 m.n., para recargar el celular, pagar servicios y comprar en Mercado Libre con tu saldo disponible.</p>
                <a href="https://mpago.li/2yxLMmc" class="referral-link" target="_blank">Descargar App</a>
            </div>

            <div class="referral-offer">
                <img src="./logos/mercado-pago.png" class="offer-logo" alt="Logo Mercado Pago">
                <p class="offer-text">Adquiere tu terminal Point hasta con 77% de descuento con la siguiente invitación.</p>
                <a href="https://mpago.li/1iXHin1" class="referral-link" target="_blank">Obtener Descuento</a>
            </div>

            <!-- En el futuro, agregar más promociones aquí -->
        </div>

        <!-- Información de porcentajes -->
        <div id="ratesInfo" class="rates-info" style="display: none;"></div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        let providers = [
            { name: 'Mercado Pago', rate: 0.035 },
            { name: 'Clip', rate: 0.036 },
            { name: 'Uala Bis', rate: 0.032 },
            { name: 'Zettle', rate: 0.031 }
        ];
        const logoUrls = {
            'Mercado Pago': './logos/mercado-pago.png',
            'Clip': './logos/clip.png',
            'Uala Bis': './logos/uala-bis.png',
            'Zettle': './logos/zettle.png'
        };

        // Carga tasa desde Google Sheets
        fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSO80a7kTMAV55psfXj8EYV_eta9hA0nqwbBev0tH7YZtmhtYT44LDXxMTNv3RMOX7Kv_bw1Z-tO8Tc/pub?gid=899706662&single=true&output=csv')
            .then(r => r.text())
            .then(text => {
                const rows = text.split('\n').slice(1);
                const newProv = rows.map(r => { const [t, rate] = r.split(','); return { name: t.trim(), rate: parseFloat(rate) }; }).filter(p => p.rate > 0);
                if (newProv.length) providers = newProv;
                updateRatesInfo();
            }).catch(() => updateRatesInfo());

        function updateRatesInfo() {
            const r = document.getElementById('ratesInfo');
            let html = '<p><strong>Porcentajes de comisión:</strong></p>';
            providers.forEach(p => html += `<p>- ${p.name}: ${(p.rate*100).toFixed(2)}%</p>`);
            html += `<p><small>Última actualización: ${new Date().toLocaleString('es-MX')}</small></p>`;
            r.innerHTML = html;
        }

        function calculate() {
            const amount = parseFloat(document.getElementById('amount').value);
            if (!amount || amount <= 0) return;
            const data = providers.map(p => {
                const com = amount * p.rate;
                const iva = com * 0.16;
                return { name: p.name, commission: com, iva: iva, total: com+iva, net: amount - (com+iva) };
            });
            let html = '<h2 class="text-center">Resultados:</h2>';
            data.forEach(d => {
                html += `
                <div class="card result-item">
                  <div class="card-body d-flex align-items-center">
                    <img src="${logoUrls[d.name]}" class="terminal-logo">
                    <div class="result-details">
                      <div class="commission"><strong>Comisión:</strong><br>$${d.commission.toFixed(2)}</div>
                      <div class="iva"><strong>IVA:</strong><br>$${d.iva.toFixed(2)}</div>
                      <div class="total"><strong>Comisión total:</strong><br>$${d.total.toFixed(2)}</div>
                    </div>
                    <div class="net-amount net"><strong>Neto:</strong><br>$${d.net.toFixed(2)}</div>
                  </div>
                </div>`;
            });
            document.getElementById('results').innerHTML = html;
            document.getElementById('ratesInfo').style.display = 'block';
            document.getElementById('referralBanner').style.display = 'block';
        }
    </script>
</body>
</html>
